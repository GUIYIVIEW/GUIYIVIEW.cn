---
title: iOS LaunchScreen.storyboard启动图更新
date: 2022-11-04 15:37:50
tags:
- iOS
- 启动图
categories:
- iOS
---

根据苹果要求2020年4月之后上线的APP都必须使用LaunchScreen适配启动图，在研究的过程中发现还是有一些坑的，记录一下。

环境: Xcode 11.3 + iPhone 11 + iOS 13.3

使用LaunchScreen设置启动图运行，之后更新图片内容，发现运行仍然是旧的图片。也试过网上的改名字、删除sb再新建、卸载重装、卸载+重启后重装，只有最后一项是每次都是正确的，前几项大多数情况下还是错误的。

使用模拟器测试发现，只有在全面屏时会更新失效。

**以下路径只在iOS 13系统下测试，其他设备的路径未测试。建议执行下面操作时每个版本只执行一次，否则不知道会不会出现黑白屏之类的情况。测试的时候没有执行下面代码，仅仅是频繁更换启动图就会出现黑白屏。**

##### 1.直接删除截图存放的路径目录
```
    NSString *path = [NSHomeDirectory() stringByAppendingPathComponent:@"Library/SplashBoard/Snapshots"];
    [[NSFileManager defaultManager] removeItemAtPath:path error:nil];
```
可能有些莫名的情况下会会出现黑白屏，这时候使用`1`方法并不能完美解决，使用下面的`2`方法测试，即时是出现了黑屏，替换之后也可以显示正常。
##### 2.替换截图目录下文件
```
    // 获取截图存储路径
    NSString *bundleID = [[NSBundle mainBundle].infoDictionary objectForKey:@"CFBundleVersion"];
    NSString *shotsDirName = [bundleID stringByAppendingString:@" - {DEFAULT GROUP}"];
    NSString *shotsPath = [NSHomeDirectory() stringByAppendingPathComponent:@"Library/SplashBoard/Snapshots"];
    shotsPath = [shotsPath stringByAppendingPathComponent:shotsDirName];
    NSError *readError = nil;
    NSArray *files = [[NSFileManager defaultManager] contentsOfDirectoryAtPath:shotsPath error:&readError];
    // 遍历该目录下截图文件
    for (NSString *fileName in files) {
        NSString *path = [shotsPath stringByAppendingPathComponent:fileName];
        NSError *error = nil;
        NSData *data = [NSData dataWithContentsOfFile:path options:NSDataReadingMappedIfSafe error:&error];
        if (!error && [data length]) {
            UIImage *image = [UIImage imageWithData:data];
            if (image) {
                UIImage *launchImage = [UIImage imageNamed:@"launch"];
                // 设置图片尺寸为旧图尺寸
                launchImage = [launchImage imageByResizeToSize:image.size contentMode:UIViewContentModeScaleAspectFit];
                // 写入目录，替换旧图
                NSData *launchData = UIImagePNGRepresentation(launchImage);
                [launchData writeToFile:path atomically:YES];
            }
        }
    }
```
**以上两种方法都只能保证更新后二次启动是显示正确的，首次启动没找到办法。**


然而大多数人都想要酷炫的启动，创建出了很多启动动画，那么这时候对于苹果要求的一张图适配所有屏幕就可能会产生很多问题，比如图片在原有的坐标上可能发生偏移，而你也不知道到底偏移了多少。

看到有人提出这样的方案，原理还是跟之前的LaunchImage一样，但是不知道这个能不能在苹果最新的这个规则下上架。[此处是链接哦]([https://juejin.im/post/5e1463d4f265da5d716e572d](https://juejin.im/post/5e1463d4f265da5d716e572d)
)

以上仅限于个人只有一个手机，若有其他情况，大家也可以补充。

## 更新：经过与苹果官方开发人员讨论，明确表示这种情况只在开发模式下频繁出现，在AppStore上不会出现。
